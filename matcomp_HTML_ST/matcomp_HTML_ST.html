<!DOCTYPE html>
<html>
<head>
	<title>MMPDS Analyzer</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<meta name="format-detection" content="telephone=no">
	<meta name="format-detection" content="date=no">
	
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
    /* ========================================================================
       EMBEDDED CSS - Derived from assets/nemesis-blue.css
       ======================================================================== */
    
    :root {
        /* REDUCED FONT SIZE from 1.375rem to 1.1rem as requested */
        font-size: 1.1rem; 
        color-scheme: dark;
        --lfw: 240px;
        --cardinal: #c23;
        --cool: #69f;
        --evening: #26f;
        --galaxy-gray: #52526a;
        --ghost: #8bf;
        --grape: #96c;
        --honey: #fc9;
        --lawn: #9a2;
        --martian: #9c3;
        --midnight: #23f;
        --moonbeam: #ebf0ff;
        --pumpkinshade: #f74;
        --roseblush: #c66;
        --tangerine: #f83;
        --wheat: #ca8;
        --left-frame-top-color: var(--evening);
        --left-frame-color: var(--evening);
        --left-frame-padding: .75rem;
        --corner-color-top: var(--evening);
        --corner-color-bottom: var(--evening);
        --panel-1-color: var(--wheat);
        --panel-2-color: var(--moonbeam);
        --panel-4-color: var(--evening);
        --panel-5-color: var(--cool);
        --panel-6-color: var(--evening);
        --panel-7-color: var(--evening);
        --panel-8-color: var(--moonbeam);
        --panel-10-color: var(--evening);
        --panel-top-button-color: var(--tangerine);
        --bar-height: 28px;
        --bar-1-6-width: 40%;
        --bar-2-7-width: 4%;
        --bar-3-8-width: 17%;
        --bar-5-10-width: 4%;
        --bar-1-color: var(--evening);
        --bar-2-color: var(--honey);
        --bar-3-color: var(--cool);
        --bar-4-color: var(--midnight);
        --bar-5-color: var(--galaxy-gray);
        --bar-6-color: var(--evening);
        --bar-7-color: var(--tangerine);
        --bar-8-color: var(--moonbeam);
        --bar-9-color: var(--evening);
        --bar-10-color: var(--galaxy-gray);
        --section-2-color: var(--cool);
        --radius-top: 0 0 0 160px;
        --radius-bottom: 160px 0 0 0;
        --radius-content-top: 0 0 0 60px;
        --radius-content-bottom: 60px 0 0 0;
        --panel-border: .25rem solid black;
        --bar-border: .25rem solid black;
        --font-color: var(--cool);
        --sub-fonts: .875rem;
        --dc-font-size: .875rem;
        --dc-row-height: calc(var(--dc-font-size) + .125rem);
        --banner-color: var(--ghost);
        --data-cascade-color: var(--evening);
        --light-color: var(--moonbeam);
        --h1-color: var(--ghost);
        --h2-color: var(--ghost);
        --h3-color: var(--ghost);
        --h4-color: var(--ghost);
        --link-color: var(--cool);
        --code-color: var(--martian);
        --nav-width: 240px;
        --nav-1-color: var(--cool);
        --nav-2-color: var(--roseblush);
        --nav-3-color: var(--honey);
        --nav-4-color: var(--cardinal);
        --button-color: var(--cool);
        --button-color-sidebar: var(--cool);
        --lcars-bar-color: var(--evening);
        --lcars-bar-start-color: var(--midnight);
        --lcars-bar-end-color: var(--midnight);
        --lcars-bar-text-color: var(--moonbeam);
    }

    /* Reset & Basic Setup */
    *, *:after, *:before { box-sizing: border-box; }
    * { margin: 0; padding: 0; font: inherit; }
    
    @font-face {
        font-family: 'Antonio';
        font-weight: 400;
        src: url('assets/Antonio-Regular.woff2') format('woff2');
    }
    @font-face {
        font-family: 'Antonio';
        font-weight: 700;
        src: url('assets/Antonio-Bold.woff2') format('woff2');
    }

    body {
        display: flex;
        padding-top: 10px;
        padding-left: 5px;
        background-color: black;
        font-family: 'Antonio', 'Arial Narrow', sans-serif;
        font-weight: 400;
        line-height: 1.2; /* Tighter line height */
        color: var(--font-color);
        overflow-x: hidden;
    }

    /* LCARS Structure Classes */
    .wrap-standard { flex: 1; margin-inline: auto; }
    .wrap { display: flex; margin-inline: auto; padding-left: 5px; padding-right: 15px; overflow: hidden; }
    
    .left-frame-top, .left-frame {
        width: var(--lfw);
        text-align: right;
        font-weight: bold;
        color: black;
        transition: width 1s;
    }
    .left-frame-top { 
        background-color: var(--left-frame-top-color); 
        border-radius: var(--radius-top); 
        /* CRITICAL FIX A: Ensures square buttons don't obscure the rounded curve */
        overflow: hidden; 
    }
    .left-frame {
        display: flex; flex-direction: column; justify-content: space-between;
        /* Padding removed here, will be applied to inner content if needed */
        background-color: var(--left-frame-color); border-radius: var(--radius-bottom);
        /* CRITICAL FIX B: Ensure panels inside are clipped by the rounded corner */
        overflow: hidden; 
    }

    /* Panels & Buttons (Left Sidebar) */
    .panel-1-button {
        /* This is the large rounded button/panel at the top-left */
        display: flex; width: var(--lfw); justify-content: flex-end; align-items: flex-end;
        background-color: var(--panel-1-color); min-height: clamp(90px, 11vw, 160px);
        padding: var(--left-frame-padding); border-bottom: var(--panel-border);
        color: black; cursor: pointer; border: none; font-size: 1.5rem; text-transform: uppercase;
    }
    .panel-2-button {
        /* This is the small rectangular button below Panel 1 (Fix for overlap) */
        display: flex; justify-content: flex-end; align-items: flex-end;
        min-height: 3.75rem; width: var(--lfw); background-color: var(--panel-2-color);
        border: none; border-bottom: var(--panel-border); padding: var(--left-frame-padding);
        text-align: right; text-transform: uppercase; color: black; cursor: pointer;
    }

    .sidebar-button {
        /* Generic rectangular buttons in the main left frame */
        display: flex; justify-content: flex-end; align-items: flex-end;
        min-height: 3.75rem; width: var(--lfw); background-color: var(--button-color-sidebar);
        border: none; border-bottom: var(--panel-border); padding: var(--left-frame-padding);
        text-align: right; text-transform: uppercase; color: black; cursor: pointer;
    }
    .sidebar-button:hover, .panel-1-button:hover, .panel-2-button:hover, .lcars-button:hover { filter: brightness(1.15); }

    /* Right Frame */
    .right-frame-top, .right-frame { flex: 1; position: relative; }
    .right-frame-top:before, .right-frame:before {
        content: ''; display: block; width: 60px; height: 60px; position: absolute; left: 0; z-index: -1;
    }
    .right-frame-top:before { bottom: var(--bar-height); background: linear-gradient(to top right, var(--corner-color-top) 50%, black 50%); }
    .right-frame:before { top: var(--bar-height); background: linear-gradient(to bottom right, var(--corner-color-bottom) 50%, black 50%); }
    
    .right-frame-top:after, .right-frame:after {
        content: ''; display: block; width: 60px; height: 60px; background-color: black; position: absolute; left: 0; z-index: -1;
    }
    .right-frame-top:after { bottom: var(--bar-height); border-radius: var(--radius-content-top); }
    .right-frame:after { top: var(--bar-height); border-radius: var(--radius-content-bottom); }

    /* Bars */
    .bar-panel { display: flex; height: var(--bar-height); }
    .first-bar-panel { margin-top: .5rem; }
    .bar-1 { width: var(--bar-1-6-width); background-color: var(--bar-1-color); border-right: var(--bar-border); }
    .bar-2 { width: var(--bar-2-7-width); background-color: var(--bar-2-color); border-right: var(--bar-border); }
    .bar-3 { width: var(--bar-3-8-width); background-color: var(--bar-3-color); border-right: var(--bar-border); }
    .bar-4 { flex: 1; background-color: var(--bar-4-color); border-right: var(--bar-border); }
    .bar-5 { width: var(--bar-5-10-width); background-color: var(--bar-5-color); }
    
    .bar-6 { width: var(--bar-1-6-width); background-color: var(--bar-6-color); border-right: var(--bar-border); }
    .bar-7 { width: var(--bar-2-7-width); background-color: var(--bar-7-color); border-right: var(--bar-border); }
    .bar-8 { width: var(--bar-3-8-width); height: 50%; background-color: var(--bar-8-color); border-right: var(--bar-border); }
    .bar-9 { flex: 1; background-color: var(--bar-9-color); border-right: var(--bar-border); }
    .bar-10 { width: var(--bar-5-10-width); background-color: var(--bar-10-color); }

    /* Content Area */
    main { padding-top: clamp(1rem, 4vw, 45px); padding-left: clamp(20px, 3vw, 50px); padding-right: 20px;}
    .banner { 
        text-align: right; 
        text-transform: uppercase; 
        font-size: clamp(1.25rem, 0.75rem + 4vw, 3.75rem); 
        color: var(--banner-color); 
        line-height: 1.1; 
        margin-bottom: 1rem; 
        display: block; 
    }
    
    /* NEW: Stardate and Status Bar Container */
    .status-bar-container {
        display: flex;
        justify-content: space-between; /* Push items to far left and far right */
        align-items: center;
        padding-top: .25rem;
        padding-left: clamp(20px, 3vw, 50px); /* Match main content padding */
        padding-right: 20px; /* Match main content padding */
    }

    /* NEW: Stardate Styling */
    .stardate-text { 
        font-size: 1.4rem; /* Matching floor-text size */
        text-align: left; 
        text-transform: uppercase; 
        color: var(--tangerine); /* Orange color */
        font-weight: 700;
    }
    
    .floor-text { 
        font-size: 1.4rem; 
        text-align: right; 
        text-transform: uppercase; 
        color: var(--cool); 
    }
    
    /* Side Panels numbers */
    .panel-3, .panel-4, .panel-5, .panel-6, .panel-7, .panel-8, .panel-9 { 
        border-bottom: var(--panel-border); 
        padding: var(--left-frame-padding); 
        /* FIX A: Ensure content aligns right to hide any stray pixels on the left curve */
        display: flex;
        justify-content: flex-end;
        align-items: center; /* Center text vertically */
    }
    .panel-10 { height: 30vh; background-color: var(--panel-10-color); border-top: var(--panel-border); }
    .panel-3 { height: 100px; background-color: var(--panel-4-color); }
    .panel-4 { height: 150px; background-color: var(--panel-4-color); }
    .panel-8 { height: 100px; background-color: var(--panel-8-color); }
    
    /* LCARS Data Cascade (Simplified for brevity but styled) */
    .data-cascade-button-group { display: flex; justify-content: flex-end; }
    .data-cascade-wrapper { 
        display: flex; 
        gap: 0.5rem; 
        justify-content: flex-end; 
        /* Ensure it wraps the new, wider columns */
        min-width: 400px;
    }
    .data-column { 
        text-align: right; 
        font-size: 0.75rem; 
        color: var(--data-cascade-color); 
        padding: 2px;
    }
    .dc-row-1 { color: var(--tangerine); transition: color 0.1s; }
    .dc-highlight { color: var(--honey) !important; font-weight: bold; } /* Highlight for effect */
    
    /* Navigation */
    nav { display: flex; gap: 0.5rem; justify-content: flex-end; margin-left: 1rem; }
    nav button {
        background-color: var(--button-color); border-radius: 100vmax; height: 60px; width: 120px;
        border: none; font-weight: bold; font-size: 1rem; display: flex; align-items: flex-end; justify-content: flex-end;
        padding: 0.5rem 1rem; text-transform: uppercase; cursor: pointer;
    }
    nav button:nth-child(1) { background-color: var(--nav-1-color); }
    nav button:nth-child(2) { background-color: var(--nav-2-color); }
    nav button:nth-child(3) { background-color: var(--nav-3-color); }
    nav button:nth-child(4) { background-color: var(--nav-4-color); }

    /* Custom App Styles */
    h1 { color: var(--h1-color); font-size: 2.2rem; text-transform: uppercase; text-align: right; margin-bottom: 0.5rem; }
    h2 { color: var(--tangerine); font-size: 1.6rem; text-transform: uppercase; margin-bottom: 2rem; border-bottom: 2px solid var(--evening); display: inline-block; }
    
    .lcars-box {
        border: 4px solid var(--evening);
        border-radius: 0 0 20px 0;
        padding: 20px;
        margin-bottom: 20px;
        background: rgba(0,0,0,0.5);
    }

    input[type="file"] {
        font-family: 'Antonio', sans-serif;
        color: var(--tangerine);
        font-size: 1.2rem;
    }

    select {
        background: var(--midnight);
        color: var(--moonbeam);
        border: none;
        padding: 10px;
        font-size: 1.2rem;
        font-family: 'Antonio', sans-serif;
        text-transform: uppercase;
        width: 100%;
        margin-bottom: 10px;
        border-left: 10px solid var(--tangerine);
    }
    
    .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 1.1rem;
    }
    .comparison-table th {
        text-align: left;
        color: var(--tangerine);
        border-bottom: 1px solid var(--evening);
        padding: 5px;
    }
    .comparison-table td {
        padding: 5px;
        border-bottom: 1px solid #333;
        color: var(--moonbeam);
    }
    .val-pos { color: var(--martian); }
    .val-neg { color: var(--cardinal); }
    .val-neu { color: var(--ghost); }

    .hidden { display: none; }
    
    .lcars-action-btn {
        background-color: var(--tangerine);
        color: black;
        border: none;
        padding: 10px 20px;
        font-family: 'Antonio', sans-serif;
        font-size: 1.2rem;
        font-weight: bold;
        text-transform: uppercase;
        cursor: pointer;
        border-radius: 0 20px 20px 0;
        margin-top: 10px;
    }
    </style>
</head>
<body>
	<audio id="audio1" src="assets/beep1.mp3" preload="auto"></audio>
	<audio id="audio2" src="assets/beep2.mp3" preload="auto"></audio>
	<audio id="audio3" src="assets/beep3.mp3" preload="auto"></audio>
	<audio id="audio4" src="assets/beep4.mp3" preload="auto"></audio>
    <audio id="audio5" src="assets/alert1.mp3" preload="auto"></audio>
    <audio id="audio6" src="assets/bosun1.mp3" preload="auto"></audio>
    
	<section class="wrap-standard" id="column-3">
		<div class="wrap">
            <div class="left-frame-top">
				<button onclick="playSound('audio5')" class="panel-1-button">USS Abot NCC-2C01</button>
				<button onclick="playSound('audio6')" class="panel-2-button">01<span class="hop">-Integration</span></button>
			</div>
			
            <div class="right-frame-top">
				<div class="banner">
                    STARFLEET MATERIAL DATA &#149; <span id="project-id">AB1-251129V01</span>
                </div>
				<div class="data-cascade-button-group">
					<div class="data-cascade-wrapper" id="data-cascade">
                        <div class="data-column"><div class="dc-row-1">93</div><div class="dc-row-1">1853</div><div class="dc-row-1">24109</div></div>
                        <div class="data-column"><div class="dc-row-1">47148</div><div class="dc-row-1">0031</div><div class="dc-row-1">9987</div></div>
                        <div class="data-column"><div class="dc-row-1">585101</div><div class="dc-row-1">25403</div><div class="dc-row-1">31219</div></div>
                        <div class="data-column"><div class="dc-row-1">0628</div><div class="dc-row-1">11968</div><div class="dc-row-1">2025</div></div>
                        <div class="data-column"><div class="dc-row-1">7750</div><div class="dc-row-1">2039</div><div class="dc-row-1">1847</div></div>
						<div class="data-column"><div class="dc-row-1">21509</div><div class="dc-row-1">68417</div><div class="dc-row-1">80</div></div>
                        <div class="data-column"><div class="dc-row-1">1110</div><div class="dc-row-1">0419</div><div class="dc-row-1">0840</div></div>
					</div>					
					<nav> 
						<button onclick="playSound('audio1')">MMPDS</button>
						<button onclick="playSound('audio2')">DATA</button>
						<button onclick="playSound('audio3')">SPEC</button>
						<button onclick="playSound('audio4')">COMPARE</button>
					</nav>
				</div>
                <div class="status-bar-container">
                    <div id="stardate-display-full" class="stardate-text">STARDATE: 0.00</div>
                    <div class="floor-text">FEDERATION WIDE AREA NETWORK: STATUS OPTIMAL</div>
                </div>

				<div class="bar-panel first-bar-panel">
					<div class="bar-1"></div><div class="bar-2"></div><div class="bar-3"></div><div class="bar-4"></div><div class="bar-5"></div>
				</div>
			</div>
		</div>

        <div class="wrap" id="gap">
            <div class="left-frame">
				<button onclick="topFunction(); playSound('audio4')" id="topBtn" style="display:none;"><span class="hop">screen</span> top</button>
				<div>
                    <button onclick="playSound('audio3')" class="sidebar-button button-evening">CDRE<span class="hop">-Visvanatha</span></button>
					<div class="panel-3">CAPTAIN<span class="hop">-Moosavian</span></div>
					<div class="panel-4">LT CMD<span class="hop">-Jirasek</span></div>
					<div class="panel-8">LT<span class="hop">-Erdelyi</span></div>
				</div>
				<div><div class="panel-10">STANDBY<span class="hop">-Red Shirt 1</span></div></div>
			</div>

            <div class="right-frame">
				<div class="bar-panel">
					<div class="bar-6"></div><div class="bar-7"></div><div class="bar-8"></div><div class="bar-9"></div><div class="bar-10"></div>
				</div>
				<main>
                    <h1>MMPDS Analysis Grid</h1>
                    
                    <div class="lcars-box">
                        <h2>1. Initialize Dataset</h2>
                        <input type="file" id="csv-file" accept=".csv" />
                        <div id="status-display" style="color:var(--honey); margin-top:10px;">WAITING FOR INPUT...</div>
                    </div>

                    <div id="controls-area" class="lcars-box hidden">
                        <h2>2. Select Materials</h2>
                        
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                            <div>
                                <label style="color:var(--cool)">REFERENCE MATERIAL (A)</label>
                                <select id="sel-ref"></select>
                            </div>
                            <div>
                                <label style="color:var(--grape)">COMPARISON MATERIAL (B)</label>
                                <select id="sel-comp"></select>
                            </div>
                        </div>
                        
                        <button class="lcars-action-btn" onclick="runComparison()">INITIATE COMPARISON</button>
                    </div>

                    <div id="results-area" class="lcars-box hidden">
                        <h2>3. Analysis Output</h2>
                        <div id="table-container"></div>
                    </div>

				</main>
				<footer>Content &copy; 2025 Starfleet Integration Stress. LCARS Inspired Website Template by The Botman</a>.</footer> 
			</div>
		</div>
	</section>	

	<div class="headtrim"> </div>
	<div class="baseboard"> </div>

    <script>
        // --- LCARS BASIC JS ---
        function playSound(id) { 
            try { 
                const audio = document.getElementById(id);
                // Rewind and play to ensure sound plays on every click
                audio.currentTime = 0;
                audio.play(); 
            } catch(e){
                console.warn(`Could not play audio ${id}: ${e.message}`);
            } 
        }
        function topFunction() { document.body.scrollTop = 0; document.documentElement.scrollTop = 0; }
        
        // --- STAR DATE CLOCK FUNCTION ---
        // Custom Stardate formula: (Current Year - 2020) × 1000 + (DayOfYear / 365) × 1000
        function generateStardate() {
            const now = new Date();
            const currentYear = now.getFullYear();

            // Calculate Day of Year (DoY)
            const startOfYear = new Date(currentYear, 0, 1);
            const diff = now - startOfYear;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay) + 1; // +1 since we start counting from day 1

            // Use 365.25 for average year length
            const daysInYear = 365.25; 

            // Calculate the Stardate
            const baseYears = currentYear - 2020;
            const yearFraction = dayOfYear / daysInYear;

            // Formula: (Current Year - 2020) × 1000 + (DayOfYear / 365) × 1000
            const stardate = (baseYears * 1000) + (yearFraction * 1000);

            // Format to 2 decimal places
            return stardate.toFixed(2);
        }

        function updateClock() {
            const sdElement = document.getElementById('stardate-display-full');
            if(sdElement) {
                sdElement.textContent = `STARDATE: ${generateStardate()}`;
            }
        }
        // Initialize and set the update interval for the Stardate
        setInterval(updateClock, 1000);
        updateClock(); // Call immediately to avoid initial delay


        // --- DATA CASCADE ANIMATION ---
        function updateDataCascade() {
            const cascade = document.getElementById('data-cascade');
            if (!cascade) return;

            const allRows = cascade.querySelectorAll('.dc-row-1');
            
            // Clear all highlights
            allRows.forEach(row => row.classList.remove('dc-highlight'));

            // Select 1 to 3 random rows to highlight
            const numToHighlight = Math.floor(Math.random() * 3) + 1; 
            for (let i = 0; i < numToHighlight; i++) {
                const randomIndex = Math.floor(Math.random() * allRows.length);
                allRows[randomIndex].classList.add('dc-highlight');
            }
        }
        // Run the animation loop
        setInterval(updateDataCascade, 400);

        // --- CORE APPLICATION LOGIC ---
        let rawRows = [], columns = [], numericalCols = [], dataByKey = {}, materialKeys = [];

        document.getElementById('csv-file').addEventListener('change', function(e){
            const f = e.target.files[0]; 
            if(!f) return;
            
            document.getElementById('status-display').textContent = "DECRYPTING...";
            playSound('audio3');

            Papa.parse(f, { 
                header: true, 
                skipEmptyLines: true, 
                dynamicTyping: false,
                complete: function(results){ 
                    rawRows = results.data; 
                    columns = results.meta.fields; 
                    buildModel(); 
                    document.getElementById('status-display').textContent = "DATASET LOADED. READY.";
                    document.getElementById('controls-area').classList.remove('hidden');
                    playSound('audio1');
                },
                error: function(err){ 
                    console.error('CSV parse error:', err);
                    document.getElementById('status-display').textContent = "ERROR: Failed to parse CSV.";
                }
            });
        });

        function buildModel(){
            const idxBasis = columns.indexOf('Basis');
            const idxRef = columns.indexOf('Ref');
            
            if(idxBasis === -1 || idxRef === -1){ 
                console.error("CSV structure mismatch: Must contain 'Basis' and 'Ref' columns."); 
                document.getElementById('status-display').textContent = "ERROR: Missing required columns ('Basis'/'Ref').";
                return; 
            }
            
            numericalCols = columns.slice(idxBasis+1, idxRef);
            
            const trailing = columns.slice(idxRef+1); 
            if(trailing.map(c=>c.toLowerCase()).includes('density')) numericalCols.push('Density'); // Use capitalized 'Density' if it exists

            dataByKey = {}; 
            materialKeys = [];
            
            rawRows.forEach(r=>{
                const ID = r['ID'] ?? '', Material = r['Material'] ?? '', Basis = r['Basis'] ?? '', Condition = r['Condition'] ?? '', Form = r['Form'] ?? '', Thickness = r['Thickness'] ?? '';
                const key = `ID:${ID} | ${Material} (${Basis}) – C:${Condition} | F:${Form} | T:${Thickness}`;
                dataByKey[key] = r; 
                materialKeys.push(key);
            });
            
            populateSelects();
        }

        function populateSelects(){
            const s1 = document.getElementById('sel-ref');
            const s2 = document.getElementById('sel-comp');
            s1.innerHTML = ''; s2.innerHTML = '';

            materialKeys.forEach(k=>{
                const txt = k.replace(/\|/g, '•'); 
                s1.add(new Option(txt, k));
                s2.add(new Option(txt, k));
            });
            
            if(materialKeys.length > 1) s2.selectedIndex = 1;
        }

        function runComparison(){
            const k1 = document.getElementById('sel-ref').value;
            const k2 = document.getElementById('sel-comp').value;
            
            if(!k1 || !k2) return;
            
            const r1 = dataByKey[k1];
            const r2 = dataByKey[k2];
            
            let html = `
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th style="width:30%">PROPERTY</th>
                        <th style="width:25%">MATERIAL A: <br> ${r1['Material'] || 'REF'}</th>
                        <th style="width:25%">MATERIAL B: <br> ${r2['Material'] || 'COMP'}</th>
                        <th style="width:20%">DELTA</th>
                    </tr>
                </thead>
                <tbody>`;
            
            numericalCols.forEach(col => {
                // Ensure values are parsed correctly, defaulting to 0 for calculation if missing
                const val1 = parseFloat(r1[col]) || 0;
                const val2 = parseFloat(r2[col]) || 0;
                
                // Text representation for display
                const show1 = r1[col] || '---';
                const show2 = r2[col] || '---';
                
                let deltaStr = '';
                let deltaClass = 'val-neu';
                
                // Only calculate percentage delta if the reference value (val1) is non-zero
                if(val1 !== 0){
                    const pct = ((val2 - val1) / val1) * 100;
                    const symbol = pct >= 0 ? '+' : '';
                    deltaStr = `${symbol}${pct.toFixed(2)}%`;
                    
                    if(pct > 0) deltaClass = "val-pos";
                    else if(pct < 0) deltaClass = "val-neg";
                } else if(val2 !== 0){
                    // If ref is zero and comp is non-zero, indicate a large change
                    deltaStr = "+100% (From 0)";
                    deltaClass = "val-pos";
                } else {
                    deltaStr = "N/A";
                    deltaClass = "val-neu";
                }
                
                html += `
                <tr>
                    <td>${col}</td>
                    <td>${show1}</td>
                    <td>${show2}</td>
                    <td class="${deltaClass}">${deltaStr}</td>
                </tr>`;
            });
            
            html += `</tbody></table>`;
            
            document.getElementById('table-container').innerHTML = html;
            document.getElementById('results-area').classList.remove('hidden');
            playSound('audio2');
        }
    </script>
</body>

</html>
